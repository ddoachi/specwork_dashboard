---
# ============================================================================
# SPEC METADATA - This entire frontmatter section contains the spec metadata
# ============================================================================

# === IDENTIFICATION ===
id: '1034' # Numeric ID for stable reference
title: 'Implement TypeScript Configuration and Linting'
type: 'task' # prd | epic | feature | task | subtask | bug | spike
category: 'infrastructure'

# === HIERARCHY ===
parent: '1003' # Parent spec ID
children: [] # Child spec IDs (if any)
epic: '1000' # Root epic ID for this work
domain: 'infrastructure' # Business domain

# === WORKFLOW ===
status: 'draft' # draft | reviewing | approved | in-progress | testing | done
priority: 'high' # high | medium | low
assignee: '' # Who's working on this
reviewer: '' # Who should review (optional)

# === TRACKING ===
created: '2025-08-28' # YYYY-MM-DD
updated: '2025-08-28' # YYYY-MM-DD
due_date: '' # YYYY-MM-DD (optional)
estimated_hours: 2 # Time estimate in hours
actual_hours: 0 # Time spent so far

# === DEPENDENCIES ===
dependencies: ['1032'] # Must be done before this (spec IDs)
blocks: ['1035', '1036'] # This blocks these specs
related: ['1033'] # Related but not blocking (spec IDs)

# === IMPLEMENTATION ===
pull_requests: [] # GitHub PR numbers
commits: [] # Key implementation commits
context_file: "1003.context.md" # Implementation journal
worktree: '' # Worktree path (optional)
files: ['tsconfig.base.json', '.eslintrc.json', '.prettierrc', '.husky/*'] # Key files to modify

# === METADATA ===
tags: ['typescript', 'eslint', 'prettier', 'linting', 'code-quality'] # Searchable tags
effort: 'small' # small | medium | large | epic
risk: 'low' # low | medium | high

# ============================================================================
---

# Task 1034: Implement TypeScript Configuration and Linting

## Overview

Configure strict TypeScript settings for type safety, set up comprehensive ESLint rules with Nx module boundaries, configure Prettier for consistent formatting, and implement pre-commit hooks to maintain code quality.

## Acceptance Criteria

- [ ] TypeScript configured with strict mode and ES2022 target
- [ ] ESLint rules enforce architectural constraints
- [ ] Prettier integrated for consistent formatting
- [ ] Pre-commit hooks validate code quality
- [ ] All configurations work across the monorepo
- [ ] IDE integration configured

## Technical Details

### 1. TypeScript Base Configuration

```json
// tsconfig.base.json
{
  "compileOnSave": false,
  "compilerOptions": {
    "rootDir": ".",
    "sourceMap": true,
    "declaration": false,
    "moduleResolution": "node",
    "emitDecoratorMetadata": true,
    "experimentalDecorators": true,
    "importHelpers": true,
    "target": "ES2022",
    "module": "ESNext",
    "lib": ["ES2022", "DOM"],
    "skipLibCheck": true,
    "skipDefaultLibCheck": true,
    
    // Strict type checking
    "strict": true,
    "noImplicitAny": true,
    "strictNullChecks": true,
    "strictFunctionTypes": true,
    "strictBindCallApply": true,
    "strictPropertyInitialization": false, // For NestJS
    "noImplicitThis": true,
    "alwaysStrict": true,
    
    // Additional checks
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noImplicitReturns": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedIndexedAccess": true,
    "noImplicitOverride": true,
    "noPropertyAccessFromIndexSignature": true,
    "exactOptionalPropertyTypes": true,
    "forceConsistentCasingInFileNames": true,
    
    // Module resolution
    "allowSyntheticDefaultImports": true,
    "esModuleInterop": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "incremental": true,
    
    "baseUrl": ".",
    "paths": {
      // Path mappings configured in task 1032
    }
  },
  "exclude": ["node_modules", "tmp", "dist"]
}
```

### 2. ESLint Configuration

```json
// .eslintrc.json
{
  "root": true,
  "ignorePatterns": ["**/*"],
  "plugins": ["@nx", "@typescript-eslint", "import", "prettier"],
  "extends": [
    "@nx/eslint-plugin",
    "plugin:@typescript-eslint/recommended",
    "plugin:@typescript-eslint/recommended-requiring-type-checking",
    "plugin:import/recommended",
    "plugin:import/typescript",
    "prettier"
  ],
  "overrides": [
    {
      "files": ["*.ts", "*.tsx"],
      "parserOptions": {
        "project": ["./tsconfig.*?.json"]
      },
      "rules": {
        // Nx module boundaries
        "@nx/enforce-module-boundaries": [
          "error",
          {
            "enforceBuildableLibDependency": true,
            "allow": [],
            "depConstraints": [
              {
                "sourceTag": "scope:shared",
                "onlyDependOnLibsWithTags": ["scope:shared"]
              },
              {
                "sourceTag": "scope:domain",
                "onlyDependOnLibsWithTags": ["scope:shared", "scope:domain"]
              },
              {
                "sourceTag": "scope:infrastructure",
                "onlyDependOnLibsWithTags": ["scope:shared", "scope:domain", "scope:infrastructure"]
              },
              {
                "sourceTag": "scope:brokers",
                "onlyDependOnLibsWithTags": ["scope:shared", "scope:domain", "scope:infrastructure"]
              },
              {
                "sourceTag": "scope:apps",
                "onlyDependOnLibsWithTags": ["*"]
              }
            ]
          }
        ],
        
        // TypeScript rules
        "@typescript-eslint/no-unused-vars": ["error", { "argsIgnorePattern": "^_" }],
        "@typescript-eslint/no-explicit-any": "warn",
        "@typescript-eslint/explicit-function-return-type": "warn",
        "@typescript-eslint/no-floating-promises": "error",
        "@typescript-eslint/await-thenable": "error",
        "@typescript-eslint/no-misused-promises": "error",
        "@typescript-eslint/require-await": "error",
        "@typescript-eslint/no-unsafe-assignment": "warn",
        "@typescript-eslint/no-unsafe-call": "warn",
        "@typescript-eslint/no-unsafe-member-access": "warn",
        "@typescript-eslint/no-unsafe-return": "warn",
        
        // Import rules
        "import/order": [
          "error",
          {
            "groups": ["builtin", "external", "internal", "parent", "sibling", "index"],
            "newlines-between": "always",
            "alphabetize": {
              "order": "asc",
              "caseInsensitive": true
            }
          }
        ],
        "import/no-duplicates": "error",
        "import/no-cycle": "error",
        
        // General rules
        "prefer-const": "error",
        "no-var": "error",
        "no-console": ["warn", { "allow": ["warn", "error"] }],
        "no-debugger": "error"
      }
    },
    {
      "files": ["*.spec.ts", "*.test.ts"],
      "rules": {
        "@typescript-eslint/no-explicit-any": "off",
        "@typescript-eslint/no-non-null-assertion": "off",
        "@typescript-eslint/no-unsafe-assignment": "off"
      }
    }
  ]
}
```

### 3. Prettier Configuration

```json
// .prettierrc
{
  "singleQuote": true,
  "printWidth": 100,
  "tabWidth": 2,
  "useTabs": false,
  "semi": true,
  "trailingComma": "all",
  "bracketSpacing": true,
  "bracketSameLine": false,
  "arrowParens": "always",
  "endOfLine": "lf"
}
```

### 4. Pre-commit Hooks Setup

```bash
# Install husky and lint-staged
npm install --save-dev husky lint-staged

# Initialize husky
npx husky install

# Add pre-commit hook
npx husky add .husky/pre-commit "npx lint-staged"
```

```json
// package.json additions
{
  "scripts": {
    "prepare": "husky install",
    "lint": "nx run-many --target=lint --all",
    "lint:fix": "nx run-many --target=lint --all --fix",
    "format": "prettier --write .",
    "format:check": "prettier --check .",
    "type-check": "nx run-many --target=type-check --all"
  },
  "lint-staged": {
    "*.{ts,tsx}": [
      "eslint --fix",
      "prettier --write"
    ],
    "*.{json,md,yaml,yml}": [
      "prettier --write"
    ]
  }
}
```

### 5. Type Check Target

```json
// nx.json addition
{
  "targetDefaults": {
    "type-check": {
      "executor": "@nx/js:tsc",
      "options": {
        "tsConfig": "{projectRoot}/tsconfig.lib.json",
        "noEmit": true
      },
      "dependsOn": ["^type-check"],
      "inputs": ["default"],
      "cache": true
    }
  }
}
```

## Implementation Steps

1. **Configure TypeScript** (30 min)
   - Update tsconfig.base.json with strict settings
   - Configure compiler options for ES2022
   - Set up strict type checking rules

2. **Set up ESLint** (45 min)
   - Install ESLint plugins and configs
   - Configure architectural boundary rules
   - Set up TypeScript-specific rules

3. **Configure Prettier** (15 min)
   - Create .prettierrc configuration
   - Add .prettierignore for excluded files
   - Test formatting across different file types

4. **Implement pre-commit hooks** (20 min)
   - Install and configure husky
   - Set up lint-staged configuration
   - Test pre-commit workflow

5. **Add type-check target** (10 min)
   - Configure type-check in nx.json
   - Add npm scripts for type checking
   - Verify across all projects

## Testing

```bash
# Run linting
nx lint

# Fix linting issues
nx lint --fix

# Format code
npm run format

# Check formatting
npm run format:check

# Run type checking
npm run type-check

# Test pre-commit hook
git add .
git commit -m "test: pre-commit hooks"

# Verify module boundaries
nx lint shared-utils
```

## Success Metrics

- Zero TypeScript compiler errors
- ESLint runs without errors on clean code
- Prettier formatting is consistent
- Pre-commit hooks prevent bad code commits
- Module boundary violations are caught

## Notes

- TypeScript strict mode catches many bugs early
- ESLint module boundaries maintain architecture
- Prettier removes formatting debates
- Pre-commit hooks ensure quality before commits
- Consider editor integration for real-time feedback